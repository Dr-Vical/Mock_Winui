<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="RswareDesign.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:RswareDesign.Models"
    Title="RswareDesign">

    <Grid x:Name="RootGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- 투명도 오버레이: 슬라이더로 Opacity(0~0.92)를 제어, 모든 Row를 덮음 -->
        <Grid x:Name="OpacityOverlay" Background="#0A0A12" Opacity="0.15"
              IsHitTestVisible="False" Grid.RowSpan="5" Canvas.ZIndex="-1" />

        <!-- ═══════════ TITLE BAR ═══════════ -->
        <Grid x:Name="TitleBarGrid" Grid.Row="0" Height="32"
              Background="Transparent" Padding="16,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                <FontIcon Glyph="&#xE964;" FontSize="14"
                          Foreground="{ThemeResource SystemAccentColor}" />
                <TextBlock Text="RswareDesign" FontSize="12"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           VerticalAlignment="Center" />
            </StackPanel>
            <TextBlock x:Name="TitleBarSubtitle" Grid.Column="1"
                       Text="{x:Bind ViewModel.Title, Mode=OneWay}"
                       FontSize="12" Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                       HorizontalAlignment="Center" VerticalAlignment="Center" />
        </Grid>

        <!-- ═══════════ MENU BAR ═══════════ -->
        <MenuBar Grid.Row="1">
            <MenuBarItem Title="File">
                <MenuFlyoutItem Text="New">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Modifiers="Control" Key="N" />
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutItem Text="Open">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Modifiers="Control" Key="O" />
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutItem Text="Save">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Modifiers="Control" Key="S" />
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutItem Text="Save As" />
                <MenuFlyoutSeparator />
                <MenuFlyoutItem Text="Print" />
                <MenuFlyoutItem Text="Page Setup" />
                <MenuFlyoutSeparator />
                <MenuFlyoutItem Text="Exit" Click="OnExitClick" />
            </MenuBarItem>
            <MenuBarItem Title="Tools">
                <MenuFlyoutItem Text="ReScan" />
                <MenuFlyoutItem Text="ReScan Option" />
                <MenuFlyoutSeparator />
                <MenuFlyoutItem Text="Com Setting" />
            </MenuBarItem>
            <MenuBarItem Title="Views">
                <MenuFlyoutSubItem Text="Theme">
                    <MenuFlyoutItem Text="Dark" Tag="Dark" Click="OnThemeClick" />
                    <MenuFlyoutItem Text="Light" Tag="Light" Click="OnThemeClick" />
                    <MenuFlyoutItem Text="System Default" Tag="Default" Click="OnThemeClick" />
                </MenuFlyoutSubItem>
            </MenuBarItem>
            <MenuBarItem Title="Help">
                <MenuFlyoutItem Text="Release List" />
                <MenuFlyoutSeparator />
                <MenuFlyoutItem Text="About RswareDesign v1.2.1" Click="OnAboutClick" />
            </MenuBarItem>
            <MenuBarItem Title="Admin Option">
                <MenuFlyoutItem Text="Motor DB" />
                <MenuFlyoutItem Text="Param Setting" />
            </MenuBarItem>
        </MenuBar>

        <!-- ═══════════ COMMAND BAR ═══════════ -->
        <CommandBar Grid.Row="2" DefaultLabelPosition="Right"
                    Background="Transparent" IsOpen="False">
            <AppBarButton Label="Enable" Click="OnEnableClick">
                <AppBarButton.Icon>
                    <FontIcon Glyph="&#xE768;" Foreground="#FF4ADE80" />
                </AppBarButton.Icon>
            </AppBarButton>
            <AppBarButton Label="Disable All" Click="OnDisableAllClick">
                <AppBarButton.Icon>
                    <FontIcon Glyph="&#xE71A;" Foreground="#FFF87171" />
                </AppBarButton.Icon>
            </AppBarButton>
            <AppBarSeparator />
            <AppBarButton Label="Clear Fault All" Click="OnClearFaultAllClick">
                <AppBarButton.Icon>
                    <FontIcon Glyph="&#xE7BA;" Foreground="#FFFBBF24" />
                </AppBarButton.Icon>
            </AppBarButton>

            <AppBarSeparator />
            <!-- 투명도 슬라이더 -->
            <AppBarElementContainer VerticalContentAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="8" Margin="4,0">
                    <FontIcon Glyph="&#xE7B3;" FontSize="14"
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                              VerticalAlignment="Center" />
                    <Slider x:Name="OpacitySlider" Width="120"
                            Minimum="0" Maximum="100" Value="15"
                            StepFrequency="1"
                            VerticalAlignment="Center"
                            ValueChanged="OnOpacitySliderChanged"
                            ToolTipService.ToolTip="Window Opacity" />
                    <TextBlock x:Name="OpacityLabel" Text="15%"
                               FontSize="11" Width="32"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               VerticalAlignment="Center" />
                </StackPanel>
            </AppBarElementContainer>

            <CommandBar.SecondaryCommands>
                <AppBarButton Label="ReScan" Icon="Refresh" />
                <AppBarButton Label="Com Setting" Icon="Setting" />
            </CommandBar.SecondaryCommands>
        </CommandBar>

        <!-- ═══════════ MAIN CONTENT ═══════════ -->
        <Grid Grid.Row="3" Margin="8,4,8,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="260" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="170" />
            </Grid.ColumnDefinitions>

            <!-- ══════ LEFT: DRIVE TREE ══════ -->
            <Border Grid.Column="0" Margin="0,0,4,0"
                    Background="{StaticResource GlassBrush}"
                    BorderBrush="{StaticResource GlassBorderBrush}"
                    BorderThickness="1" CornerRadius="8">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" Padding="12,10" BorderBrush="{StaticResource DividerBrush}"
                          BorderThickness="0,0,0,1">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE8B7;" FontSize="14"
                                      Foreground="{ThemeResource SystemAccentColor}" />
                            <TextBlock Text="Drive Tree" FontSize="12" FontWeight="SemiBold" />
                        </StackPanel>
                    </Grid>

                    <TreeView Grid.Row="1" x:Name="DriveTree"
                              SelectionMode="Single" CanDragItems="False"
                              ItemInvoked="OnTreeItemInvoked"
                              Margin="0,2,0,0" />

                    <!-- A/B/C/D -->
                    <Border Grid.Row="2" Background="{StaticResource GlassLowBrush}"
                            BorderBrush="{StaticResource DividerBrush}" BorderThickness="0,1,0,0"
                            CornerRadius="0,0,8,8">
                        <Grid Height="36">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Button x:Name="PanelABtn" Grid.Column="0" Content="A"
                                    HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                    Background="{StaticResource PanelAAccent}" Foreground="White"
                                    FontWeight="Bold" CornerRadius="0,0,0,8"
                                    BorderThickness="0" Click="OnPanelTabClick" Tag="A" />
                            <Button x:Name="PanelBBtn" Grid.Column="1" Content="B"
                                    HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                    Background="Transparent" Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                    FontWeight="Bold" CornerRadius="0"
                                    BorderThickness="0" Click="OnPanelTabClick" Tag="B" />
                            <Button x:Name="PanelCBtn" Grid.Column="2" Content="C"
                                    HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                    Background="Transparent" Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                    FontWeight="Bold" CornerRadius="0"
                                    BorderThickness="0" Click="OnPanelTabClick" Tag="C" />
                            <Button x:Name="PanelDBtn" Grid.Column="3" Content="D"
                                    HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                    Background="Transparent" Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                    FontWeight="Bold" CornerRadius="0,0,8,0"
                                    BorderThickness="0" Click="OnPanelTabClick" Tag="D" />
                        </Grid>
                    </Border>
                </Grid>
            </Border>

            <!-- ══════ CENTER: PARAM + ERROR ══════ -->
            <Grid Grid.Column="1" Margin="4,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="8" />
                    <RowDefinition Height="170" />
                </Grid.RowDefinitions>

                <!-- Parameter Editor -->
                <Border Grid.Row="0" Background="{StaticResource GlassBrush}"
                        BorderBrush="{StaticResource GlassBorderBrush}"
                        BorderThickness="1" CornerRadius="8">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <!-- Selected Node + Panel Label -->
                        <Grid Grid.Row="0" Padding="14,8"
                              BorderBrush="{StaticResource DividerBrush}" BorderThickness="0,0,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <TextBlock x:Name="PanelLabel"
                                       Text="{x:Bind ViewModel.ActivePanel, Mode=OneWay}"
                                       FontSize="12" FontWeight="SemiBold"
                                       Foreground="{StaticResource AccentBrush}" />
                            <TextBlock Grid.Column="1"
                                       Text="{x:Bind ViewModel.SelectedNodeName, Mode=OneWay}"
                                       FontSize="12" Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                       Margin="12,0,0,0" />
                        </Grid>

                        <!-- Column Headers -->
                        <Grid Grid.Row="1" Background="{StaticResource GridHeaderBrush}" Height="32">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="90" />
                                <ColumnDefinition Width="*" MinWidth="160" />
                                <ColumnDefinition Width="80" />
                                <ColumnDefinition Width="90" />
                                <ColumnDefinition Width="70" />
                                <ColumnDefinition Width="110" />
                                <ColumnDefinition Width="110" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="FT NUM" Style="{StaticResource CaptionTextBlockStyle}"
                                       Padding="12,0" VerticalAlignment="Center" FontWeight="SemiBold" />
                            <TextBlock Grid.Column="1" Text="PARAMETER" Style="{StaticResource CaptionTextBlockStyle}"
                                       Padding="12,0" VerticalAlignment="Center" FontWeight="SemiBold" />
                            <TextBlock Grid.Column="2" Text="VALUE" Style="{StaticResource CaptionTextBlockStyle}"
                                       Padding="12,0" VerticalAlignment="Center" FontWeight="SemiBold" />
                            <TextBlock Grid.Column="3" Text="UNITS" Style="{StaticResource CaptionTextBlockStyle}"
                                       Padding="12,0" VerticalAlignment="Center" FontWeight="SemiBold" />
                            <TextBlock Grid.Column="4" Text="DEFAULT" Style="{StaticResource CaptionTextBlockStyle}"
                                       Padding="12,0" VerticalAlignment="Center" FontWeight="SemiBold" />
                            <TextBlock Grid.Column="5" Text="MIN" Style="{StaticResource CaptionTextBlockStyle}"
                                       Padding="12,0" VerticalAlignment="Center" FontWeight="SemiBold" />
                            <TextBlock Grid.Column="6" Text="MAX" Style="{StaticResource CaptionTextBlockStyle}"
                                       Padding="12,0" VerticalAlignment="Center" FontWeight="SemiBold" />
                        </Grid>

                        <!-- Data Rows -->
                        <ListView Grid.Row="2" x:Name="ParameterListView"
                                  ItemsSource="{x:Bind ViewModel.Parameters, Mode=OneWay}"
                                  SelectionMode="Single" Background="Transparent">
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                    <Setter Property="Padding" Value="0" />
                                    <Setter Property="MinHeight" Value="30" />
                                </Style>
                            </ListView.ItemContainerStyle>
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="models:ParameterItem">
                                    <Grid Height="30" BorderBrush="{StaticResource DividerBrush}"
                                          BorderThickness="0,0,0,1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="90" />
                                            <ColumnDefinition Width="*" MinWidth="160" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="90" />
                                            <ColumnDefinition Width="70" />
                                            <ColumnDefinition Width="110" />
                                            <ColumnDefinition Width="110" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="{x:Bind FtNumber}" Padding="12,0"
                                                   VerticalAlignment="Center" FontSize="12"
                                                   FontFamily="Cascadia Code, Consolas" />
                                        <TextBlock Grid.Column="1" Text="{x:Bind Name}" Padding="12,0"
                                                   VerticalAlignment="Center" FontSize="12"
                                                   FontFamily="Cascadia Code, Consolas" />
                                        <TextBlock Grid.Column="2" Text="{x:Bind Value}" Padding="12,0"
                                                   VerticalAlignment="Center" FontSize="12"
                                                   FontWeight="SemiBold" FontFamily="Cascadia Code, Consolas"
                                                   Foreground="{StaticResource AccentBrush}" />
                                        <TextBlock Grid.Column="3" Text="{x:Bind Unit}" Padding="12,0"
                                                   VerticalAlignment="Center" FontSize="12"
                                                   FontFamily="Cascadia Code, Consolas"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                        <TextBlock Grid.Column="4" Text="{x:Bind Default}" Padding="12,0"
                                                   VerticalAlignment="Center" FontSize="12"
                                                   FontFamily="Cascadia Code, Consolas"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                        <TextBlock Grid.Column="5" Text="{x:Bind Min}" Padding="12,0"
                                                   VerticalAlignment="Center" FontSize="12"
                                                   FontFamily="Cascadia Code, Consolas"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                        <TextBlock Grid.Column="6" Text="{x:Bind Max}" Padding="12,0"
                                                   VerticalAlignment="Center" FontSize="12"
                                                   FontFamily="Cascadia Code, Consolas"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <!-- Filter Bar -->
                        <Border Grid.Row="3" Background="{StaticResource GlassLowBrush}"
                                BorderBrush="{StaticResource DividerBrush}" BorderThickness="0,1,0,0"
                                Padding="12,6" CornerRadius="0,0,8,8">
                            <StackPanel Orientation="Horizontal" Spacing="20">
                                <CheckBox Content="Show Helps" FontSize="12"
                                          IsChecked="{x:Bind ViewModel.ShowHelps, Mode=TwoWay}" />
                                <CheckBox Content="Show Status" FontSize="12"
                                          IsChecked="{x:Bind ViewModel.ShowStatus, Mode=TwoWay}" />
                                <CheckBox Content="Show Commands" FontSize="12"
                                          IsChecked="{x:Bind ViewModel.ShowCommands, Mode=TwoWay}" />
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>

                <!-- Error Log -->
                <Border Grid.Row="2" Background="{StaticResource GlassBrush}"
                        BorderBrush="{StaticResource GlassBorderBrush}"
                        BorderThickness="1" CornerRadius="8">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0" Padding="12,8"
                              BorderBrush="{StaticResource DividerBrush}" BorderThickness="0,0,0,1">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE7BA;" FontSize="12" Foreground="{StaticResource WarningBrush}" />
                                <TextBlock Text="Status / Error Log" FontSize="12" FontWeight="SemiBold" />
                            </StackPanel>
                        </Grid>

                        <Grid Grid.Row="1" Background="{StaticResource GridHeaderBrush}" Height="28">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="200" />
                                <ColumnDefinition Width="100" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="STATUS" Style="{StaticResource CaptionTextBlockStyle}"
                                       Padding="12,0" VerticalAlignment="Center" FontWeight="SemiBold" />
                            <TextBlock Grid.Column="1" Text="VALUE" Style="{StaticResource CaptionTextBlockStyle}"
                                       Padding="12,0" VerticalAlignment="Center" FontWeight="SemiBold" />
                            <TextBlock Grid.Column="2" Text="UNITS" Style="{StaticResource CaptionTextBlockStyle}"
                                       Padding="12,0" VerticalAlignment="Center" FontWeight="SemiBold" />
                        </Grid>

                        <ListView Grid.Row="2"
                                  ItemsSource="{x:Bind ViewModel.StatusEntries, Mode=OneWay}"
                                  SelectionMode="None" Background="Transparent">
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                    <Setter Property="Padding" Value="0" />
                                    <Setter Property="MinHeight" Value="28" />
                                </Style>
                            </ListView.ItemContainerStyle>
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="models:StatusEntry">
                                    <Grid Height="28" BorderBrush="{StaticResource DividerBrush}"
                                          BorderThickness="0,0,0,1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="200" />
                                            <ColumnDefinition Width="100" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="{x:Bind Status}" Padding="12,0"
                                                   VerticalAlignment="Center" FontSize="12"
                                                   FontFamily="Cascadia Code, Consolas" />
                                        <TextBlock Grid.Column="1" Text="{x:Bind Value}" Padding="12,0"
                                                   VerticalAlignment="Center" FontSize="12"
                                                   FontFamily="Cascadia Code, Consolas"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                        <TextBlock Grid.Column="2" Text="{x:Bind Units}" Padding="12,0"
                                                   VerticalAlignment="Center" FontSize="12"
                                                   FontFamily="Cascadia Code, Consolas"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>
                </Border>
            </Grid>

            <!-- ══════ RIGHT: ACTIONS ══════ -->
            <Border Grid.Column="2" Margin="4,0,0,0"
                    Background="{StaticResource GlassBrush}"
                    BorderBrush="{StaticResource GlassBorderBrush}"
                    BorderThickness="1" CornerRadius="8">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="Actions" Padding="12,10"
                               FontSize="12" FontWeight="SemiBold" />

                    <ScrollViewer Grid.Row="1" Padding="10,4,10,10">
                        <StackPanel Spacing="6">
                            <Button HorizontalAlignment="Stretch" Height="36"
                                    Style="{StaticResource AccentButtonStyle}"
                                    CornerRadius="6" Click="OnReadAllClick">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE896;" FontSize="14" />
                                    <TextBlock Text="Read All" FontSize="12" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            <Button HorizontalAlignment="Stretch" Height="36"
                                    Style="{StaticResource AccentButtonStyle}"
                                    CornerRadius="6" Click="OnWriteAllClick">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE898;" FontSize="14" />
                                    <TextBlock Text="Write All" FontSize="12" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            <Button HorizontalAlignment="Stretch" Height="36"
                                    Background="{StaticResource SecondaryBrush}"
                                    Foreground="{StaticResource TextOnAccent}"
                                    CornerRadius="6" BorderThickness="0" Click="OnSaveToFlashClick">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE74E;" FontSize="14" />
                                    <TextBlock Text="Save to Flash" FontSize="12" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            <Border Height="1" Background="{StaticResource DividerBrush}" Margin="0,4" />
                            <Button HorizontalAlignment="Stretch" Height="36" CornerRadius="6"
                                    Background="{StaticResource GlassHighBrush}"
                                    BorderBrush="{StaticResource GlassBorderBrush}" BorderThickness="1"
                                    Click="OnCompareClick">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE8F1;" FontSize="14" />
                                    <TextBlock Text="Compare" FontSize="12" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            <Button HorizontalAlignment="Stretch" Height="36" CornerRadius="6"
                                    Background="{StaticResource GlassHighBrush}"
                                    BorderBrush="{StaticResource GlassBorderBrush}" BorderThickness="1"
                                    Click="OnExportClick">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xEDE1;" FontSize="14" />
                                    <TextBlock Text="Export" FontSize="12" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            <Button HorizontalAlignment="Stretch" Height="36" CornerRadius="6"
                                    Background="{StaticResource GlassHighBrush}"
                                    BorderBrush="{StaticResource GlassBorderBrush}" BorderThickness="1"
                                    Click="OnRevertClick">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE7A7;" FontSize="14" />
                                    <TextBlock Text="Revert" FontSize="12" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Action Message -->
                    <Border Grid.Row="2" Padding="10,6"
                            Background="{StaticResource GlassLowBrush}"
                            BorderBrush="{StaticResource DividerBrush}" BorderThickness="0,1,0,0"
                            CornerRadius="0,0,8,8">
                        <TextBlock x:Name="ActionMsgText"
                                   Text="{x:Bind ViewModel.ActionMessage, Mode=OneWay}"
                                   FontSize="10" Foreground="{StaticResource AccentBrush}"
                                   TextTrimming="CharacterEllipsis" />
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- ═══════════ STATUS BAR ═══════════ -->
        <Grid Grid.Row="4" Padding="16,5" Background="{StaticResource GlassLowBrush}"
              BorderBrush="{StaticResource DividerBrush}" BorderThickness="0,1,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="6" Margin="0,0,16,0">
                <Ellipse x:Name="StatusDot" Width="8" Height="8"
                         Fill="{StaticResource ErrorBrush}" VerticalAlignment="Center" />
                <TextBlock x:Name="StatusText"
                           Text="{x:Bind ViewModel.ConnectionStatus, Mode=OneWay}"
                           FontSize="11" Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           VerticalAlignment="Center" />
            </StackPanel>
            <Border Grid.Column="1" Width="1" Height="12" Background="{StaticResource DividerBrush}"
                    VerticalAlignment="Center" Margin="0,0,16,0" />
            <TextBlock Grid.Column="2" Text="{x:Bind ViewModel.DriveInfo, Mode=OneWay}" FontSize="11"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       VerticalAlignment="Center" Margin="0,0,16,0" />
            <Border Grid.Column="3" Width="1" Height="12" Background="{StaticResource DividerBrush}"
                    VerticalAlignment="Center" Margin="0,0,16,0" />
            <TextBlock Grid.Column="4" Text="{x:Bind ViewModel.ModeInfo, Mode=OneWay}" FontSize="11"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center" />
            <TextBlock Grid.Column="5" Text="{x:Bind ViewModel.SelectedPort, Mode=OneWay}" FontSize="11"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center" />
        </Grid>
    </Grid>
</Window>
